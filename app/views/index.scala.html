@(player: Player,
  trials: Seq[(TimeTrial, Seq[RunRanking])],
  trialsUsers: Seq[User],
  finishedRaces: Seq[Race],
  users: Seq[User],
  userForm: Form[CreateUser],
  jsMessages: jsmessages.api.JsMessages
)(implicit req: RequestHeader, lang: Lang)

@import play.api.Play
@import play.api.Play.current
@import play.api.libs.json.Json
@import views.Helpers

@main {

  <div class="home">

    <div class="row">

      <div class="col-md-6">
        <p class="align-center"><img src="/assets/images/logo-tacks-wide.png"/></p>
        <p class="align-center">@Messages("home.intro")</p>

        @player match {
          case u: User => {
          }
          case g: Guest => {

            <div class="login">
              <h3>@Messages("signIn")</h3>

              <form action="@routes.Auth.submitLogin" method="post">
                <div class="row">
                  <div class="form-group col-md-5">
                    <input type="text" name="email" id="" class="form-control" placeholder="@Messages("email")"/>
                  </div>
                  <div class="form-group col-md-4">
                    <input type="password" name="password" id="" class="form-control" placeholder="@Messages("password")"/>
                  </div>
                  <div class="col-md-3">
                    <input type="submit" class="btn btn-primary btn-block" value="@Messages("signIn")">
                  </div>
                </div>
              </form>
            </div>

          }
        }
      </div>

      <div class="col-md-5 col-md-offset-1 user-block">
        @player match {
          case u: User => {
            <div class="current-user">
              <div class="pull-right">
                <a href="@routes.Auth.logout" class="btn btn-default btn-sm">@Messages("logout")</a>
              </div>
              @Messages("home.welcome"), <a href="@routes.Users.show(u.idToStr)">@u.handle</a>.

              <form action="@routes.Users.updateStatus" method="post" class="update-name">
                <div class="form-group">
                  <div class="input-group input-group-sm">
                    <input type="text" name="status" value="@u.status" class="form-control"/>
                    <div class="input-group-btn">
                      <input type="submit" value="@Messages("home.updateStatus")" class="btn btn-primary btn-block"/>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          }
          case g: Guest => {
            <div class="new-user">
              <h3>@Messages("home.newOnTacks")</h3>
              @views.html.users.createUserForm(userForm)
            </div>
          }
        }
      </div>

    </div>

    <div id="liveCenter"></div>

    <div class="time-trials row">
      <div class="col-sm-12">
        <h2>@Messages("home.timeTrials")</h2>
      </div>
    </div>
      @for(row <- trials.grouped(3)) {
        <div class="row">
          @for((trial, rankings) <- row) {
            <div class="col-sm-4">
              <div class="time-trial">
                <a href="@routes.TimeTrials.show(trial.id.stringify)" class="run"
                style="background-image: url(@routes.Assets.at(s"images/trials-${trial.slug}.png"))">
                  <span class="name">@Messages("timeTrials." + trial.slug + ".name")</span>
                  <div class="description">
                    @Messages("timeTrials." + trial.slug + ".description")
                  </div>
                </a>
                <a href="@routes.Application.playTimeTrial(trial.id.stringify)" target="_blank" class="btn btn-warning btn-block">@Messages("timeTrials.run")</a>

                @if(rankings.nonEmpty) {
                  <span class="ranking">@Messages("home.timeTrialRanking")</span>
                  <ul>
                  @for(ranking <- rankings) {
                    <li class="rank-@ranking.rank @if(ranking.playerId == player.id) { current-player }">
                      <span class="rank">@ranking.rank</span>
                      <span class="handle">
                        @trialsUsers.find(_.id == ranking.playerId).map(_.handle).getOrElse("Anonymous")
                      </span>
                      @if(ranking.isRecent) { <abbr title="@Messages("timeTrials.recent")">*</abbr> }
                      <span class="time">@if(ranking.rank == 1) {
                        @Helpers.timer(ranking.finishTime)
                      } else {
                        @Helpers.timeDelta(ranking.finishTime - rankings.map(_.finishTime).min)
                      }</span>
                    </li>
                  }
                  </ul>
                }
              </div>
            </div>
          }
        </div>
      }

    @if(finishedRaces.nonEmpty) {
      <div class="row">
        <div class="finished-races col-md-offset-3 col-md-6">
          <h3>@Messages("home.recentRaces")</h3>
          @for(r <- finishedRaces) {
            @views.html.races.finishedBoard(r, users, Some(player))
          }
        </div>
      </div>
    }

  </div>

  @helper.javascriptRouter("jsRoutes")(
    routes.javascript.Api.racesStatus,
    routes.javascript.Api.currentUser,
    routes.javascript.Api.createRace
  )

  <script type="text/javascript">
    @Html(jsMessages(Some("window.jsMessages")).body)
  </script>

  @if(Play.isProd) {
    <script src="@routes.Assets.at("javascripts/dist/liveCenter.js")" type="text/javascript"></script>
  } else {
    <script src="@routes.Assets.at("javascripts/liveCenter.js")" type="text/javascript"></script>
  }
}
