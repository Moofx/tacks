@(player: Player,
  trials: Seq[(TimeTrial, Seq[RunRanking])],
  trialsUsers: Seq[User],
  trialLeaderboard: core.TimeTrialLeaderboard.Leaderboard,
  finishedRaces: Seq[Race],
  users: Seq[User],
  userForm: Form[CreateUser],
  jsMessages: jsmessages.api.JsMessages
)(implicit req: IdentifiedRequest[_], lang: Lang)

@import play.api.Play
@import play.api.Play.current
@import play.api.libs.json.Json
@import views.Helpers
@import views.html.bootstrap3._

@main {


  <div class="title-wrapper">
    <div class="container">

      @player match {

        case u: User => {
          <h1>@Messages("home.welcome", u.handle)</h1>

          @trialLeaderboard.find(_._2 == u.id) match {
            case Some((r, _, p)) => {
              <p class="align-center">@Html(Messages("home.ranked", r, p))</p>
            }
            case None => {
              <p class="align-center">@Messages("home.notRanked")</p>

              @trials.find(_._1.slug == core.WarmUp.slug).map { case (t, _) =>
                <div class="align-center">
                  <a href="@routes.Application.playTimeTrial(t.idToStr)" class="btn btn-warning" target="blank">@Messages("home.runWarmUp")</a>
                </div>
              }
            }
          }
        }

        case _ => {

          <h1>@Messages("home.title")</h1>
          <p class="align-center">@Html(Messages("home.intro"))</p>


          <div class="row">
            <div class="col-lg-6 col-lg-offset-3">

              <form action="@routes.Users.create" method="post" class="form-new-user row">
                <div class="form-group col-lg-6">
                  <input type="text" name="email" class="form-control" placeholder="@Messages("email")"/>
                </div>
                <div class="form-group col-lg-6">
                  <input type="password" name="password" class="form-control" placeholder="@Messages("password")"/>
                </div>
                <div class="form-group col-lg-6">
                  <input type="text" name="handle" class="form-control" placeholder="@Messages("users.handle")"/>
                </div>
                <div class="form-group col-lg-6">
                  <input type="submit" value="@Messages("users.createButton")" class="btn btn-primary btn-block" />
                </div>
              </form>

            </div>
          </div>

          <p class="align-center">@Messages("or") <a href="@routes.Auth.askLogin()">@Messages("home.doLog")</a></p>


        }
      }

    </div>
  </div>

  <div class="light-wrapper">
    <div class="container">

      <h2>@Messages("home.races")</h2>

      <div class="row">
        <div class="col-lg-10 col-lg-offset-1">

          @player match {

            case u: User => {
              <div class="row">
                <form action="@routes.Users.updateStatus" method="post" class="col-lg-offset-3 col-lg-6 update-name">
                  <div class="form-group">
                    <div class="input-group input-group-sm">
                      <span class="input-group-addon" id="basic-addon1">@Messages("home.status")</span>
                      <input type="text" name="status" value="@u.status" class="form-control"/>
                      <div class="input-group-btn">
                        <input type="submit" value="@Messages("home.updateStatus")" class="btn btn-default btn-block"/>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            }

            case p: Player => {
            }
          }

          <div id="liveCenter"></div>

        </div>
      </div>

    </div>
  </div>

  <div class="dark-wrapper home-trials">
    <div class="container">

      <h2>@Messages("home.timeTrials")</h2>
      <p class="subtitle">@org.joda.time.LocalDate.now.toString("MMMM yyyy")</p>

      @for(row <- trials.grouped(3)) {
        <div class="row">
          @for((trial, rankings) <- row) {
            <div class="col-lg-4">
              <div class="time-trial">
                <a href="@routes.TimeTrials.show(trial.id.stringify)" class="run"
                style="background-image: url(@routes.Assets.at(s"images/trials-${trial.slug}.png"))">
                  <span class="name">@Messages("timeTrials." + trial.slug + ".name")</span>
                  <div class="description">
                    @Messages("timeTrials." + trial.slug + ".description")
                  </div>
                </a>
                <a href="@routes.Application.playTimeTrial(trial.id.stringify)" target="_blank" class="btn btn-warning btn-block">@Messages("timeTrials.run")</a>

                @if(rankings.nonEmpty) {
                  @views.html.timeTrials.ranking(rankings.filter(r => r.rank <= 5 || r.playerId == player.id), trialsUsers, player)
                }
              </div>
            </div>
          }
        </div>
      }

    </div>
  </div>

  @helper.javascriptRouter("jsRoutes")(
    routes.javascript.Api.racesStatus,
    routes.javascript.Api.currentUser,
    routes.javascript.Api.createRace
  )

  <script type="text/javascript">
    @Html(jsMessages(Some("window.jsMessages")).body)
  </script>

  @if(Play.isProd) {
    <script src="@routes.Assets.at("javascripts/dist/liveCenter.js")" type="text/javascript"></script>
  } else {
    <script src="@routes.Assets.at("javascripts/liveCenter.js")" type="text/javascript"></script>
  }
}
