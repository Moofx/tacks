@(race: Race)

@for(startTime <- race.startTime) {
  <div id="game" style="width:100%;height:100%"></div>

  <script type="text/javascript" src="http://elm-lang.org/elm-runtime.js"></script>
  <script type="text/javascript" src="@routes.Assets.at("javascripts/Main.js")"></script>
  <script type="text/javascript">

  var boatId = Date.now().toString();
  var raceId = "@race.id";
  var ws = new WebSocket("ws://localhost:9020/boatSocket/" + boatId + "/" + raceId);

  var gameDiv = document.getElementById('game');
  var input = { startTime: @startTime.getMillis, opponents: [] };
  var game = Elm.embed(Elm.ShiftMaster, gameDiv, { raceInput:  input});

  ws.onmessage = function(event) {
//    console.log(JSON.parse(event.data));
    game.ports.raceInput.send(event.data);
  };

  ws.onopen = function() {
    game.ports.raceOutput.subscribe(function(state) {
      ws.send(JSON.stringify(state))
    });

  };

  </script>
}